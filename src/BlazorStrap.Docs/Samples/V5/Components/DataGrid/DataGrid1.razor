<!--\\-->
@using BlazorStrap_Docs.SamplesHelpers.Content.Tables
@using BlazorStrap.V5
@using Microsoft.EntityFrameworkCore
@inject AppDbContext _db
<h3>Work in progress</h3>

<div class="d-flex justify-content-center">
    <BSAlert HasIcon="true" Color="BSColor.Info" Class="w-50">Note: Left and Right placements are not supported. They will default back to bottom placement.</BSAlert>
</div>

<div class="container mt-3">
    <div class="input-group">
        <span class="input-group-text">Items per page</span>
        <select class="form-select" aria-label="Items Per Page" @bind="@_pagination.ItemsPerPage">
            <option>5</option>
            <option>10</option>
            <option>20</option>
            <option>50</option>
        </select>
        <span class="input-group-text">Pagination Placement</span>
        <select class="form-select" aria-label="Pagination Placement" @bind="_pagination.Placement">
            <option value="@Placement.Top">Top</option>
            <option value="@Placement.TopStart">TopStart</option>
            <option value="@Placement.TopEnd">TopEnd</option>
            <option value="@Placement.Left">Left - Not Supported</option>
            <option value="@Placement.Bottom">Bottom</option>
            <option value="@Placement.BottomStart">BottomStart</option>
            <option value="@Placement.BottomEnd">BottomEnd</option>
        </select>

    </div>
    <div class="datagrid">
        <!--//-->
        <BSDataGrid IsStriped="true" IsSmall="true" Items="_employees" IsMultiSort="true" Pagination="_pagination" AsyncProvider="_asyncProvider">
            <Columns>
                <PropertyColumn Property="e => e.Id" IsSortable="true">
                    <ColumnOptions>
                        <div class="mx-2">
                            <BSInput InputType="InputType.Text" bind-Value="context.Filter" DebounceInterval="200" UpdateOnInput="true" placeholder="Filter..." TValue="string"/>
                        </div>
                    </ColumnOptions>
                </PropertyColumn>
                <PropertyColumn Property="e => e.NameObject.FirstName" IsSortable="true">
                    <ColumnOptions>
                        <div class="mx-2">
                            <BSInput InputType="InputType.Text" bind-Value="context.Filter" placeholder="Filter..." TValue="string"/>
                        </div>
                    </ColumnOptions>
                </PropertyColumn>
                <PropertyColumn Property="e => e.NameObject.LastName" IsSortable="true"/>
                <PropertyColumn Property="e => e.Email" IsSortable="true"/>
            </Columns>
        </BSDataGrid>
        <!--\\-->
    </div>
</div>
<!--//-->

@code {
    private AsyncProvider _asyncProvider = new AsyncProvider();
    private PaginationState _pagination = new PaginationState() { ItemsPerPage = 10 };
    <!--\\-->
    //This is just a auto fill class for the table for sample data.
    private readonly Table2Model _sampleData = new Table2Model();
    IQueryable<Employee> _employees;
    <!--//-->
    private Func<SortData<Employee>, SortData<Employee>> _nameSort = data =>
    {
        data.Ordered = data.Descending ? data.Query.OrderByDescending(q => q.Name) : data.Query.OrderBy(q => q.Name);
        return data;
    };
    <!--\\-->
    protected override void OnInitialized()
    {
        try
        {
            _db.Employees.AddRange(_sampleData.DataSet);
            _db.SaveChanges();
        }
        catch
        {
        }
        _employees = _db.Employees;
    }
    <!--//-->
    public class AsyncProvider : IAsyncProvider
    {
        public Task<int> CountAsync<T>(IQueryable<T> queryable)
        {
            return queryable.CountAsync();
        }

        public Task<T[]> ToArrayAsync<T>(IQueryable<T> queryable)
        {
            return queryable.ToArrayAsync();
        }
    }
}